%==========================================================
%============== MACROECONOMIA DINAMICA I===================
%================== TRABAJO FINAL==========================
%=======================ITAM===============================
%
%Nombre: PETER PAZ
%
%Profesor: CARLOS URRUTIA
%
%=====================2013=================================

%% =========================================================
% Parte I: CALCULO DE LA FUNCION VALOR y POLITICAS
%==========================================================

% Inicio
clear all
clc

tic

% Parametros del modelo
alpha = 0.4;
beta  = 0.987;
delta = 0.012;
A     = 1;
gamma=0.64;
theta = [-0.0231 -0.0115 0 0.0115 0.0231];
pi = [0.9727 0.0273 0 0 0;
0.0041 0.9806 0.0153 0 0 ;
0 0.0082 0.9837 0.0082 0 ;
0 0 0.0153 0.9806 0.0041;
0 0 0 0.0273 0.9727 ];

% Other required parameters (maximum number of iterations, size of the
% grid for k, tolerance criterion, number of periods for simulations, 
% size of the shock vector)

maxit = 1000;
p     = 100;
crit  = 1e-2;
T     = 100;
q     = 5;

% CALCULO DEL ESTADO ESTACIONARIO(kss) for an economy without uncertainty 
k_h=(  (alpha) / ( (1/beta)-(1-delta) ) )^(1/(1-alpha));
x1=((1-alpha)*((1-gamma)/gamma)*(k_h)^(alpha));
x2=(k_h)^alpha-delta*(k_h) ;
hee=x1/(x1+x2);
kee=k_h*hee;
cee= (k_h^alpha -delta*k_h )*hee;
kss   =kee;
k0    = kss;
k     = linspace(0.8*kss,1.5*kss,p);

% Construction of matrix M

value = zeros(p*q,p,4);
for i=1:p
    value((i-1)*q+1,:,1) = k(i)*ones(1,p);
    value((i-1)*q+2,:,1) = k(i)*ones(1,p);
    value((i-1)*q+3,:,1) = k(i)*ones(1,p);
    value((i-1)*q+4,:,1) = k(i)*ones(1,p);
    value((i-1)*q+5,:,1) = k(i)*ones(1,p);
end
value(:,:,2)=ones(p*q,1)*k;

vector = theta';
for i=1:p-1
    vector = [vector; theta'];
end
value(:,:,4)=vector*ones(1,p);

%=========================================================================
% Calculo de trabajo(l) para la matriz M
vec=[];
vec2=[];
matrizL=zeros(length(k),length(k),q);
iter=1;
  for m=1:q %bloques
    for j= 1:length(k) %columnas
      for l= 1:length(k) %filas
  % nn(l): labor no puede ser mayor que uno
        l0   = 0.25;
        kkk = k(j);
        kprima = k(l);
        zzz = theta(m);
        %[nn(l,m), fval ] = fsolve( @(l) hfun(l), l0 );
        [nn(l), fval, flag] = fsolve(@(l) hfunj(l,kkk,kprima,zzz),l0);
       if nn(l)>=1 | flag~=1;
          nn(l) = (1 - eps);
       end
       [vec(iter), fval, flag] = fsolve(@(l) hfunj(l,kkk,kprima,zzz),l0);
       if vec(iter)>=1 | flag~=1;
          vec(iter) = (1 - eps);
       end
       %%
       vec2(iter)= max((exp(zzz) * kkk^alpha * vec(iter)^(1-alpha)-(kprima - (1 - delta) * kkk)),eps);
       
       %%
       iter=iter+1;
        matrizL(l,j,m);
      end
    end
  end
%   
% =================================================================
L1=vec(1:10000);
L2=vec(1:20000);
L3=vec(1:30000);
L4=vec(1:40000);
L5=vec(1:50000);

C1=vec2(1:10000);
C2=vec2(1:20000);
C3=vec2(1:30000);
C4=vec2(1:40000);
C5=vec2(1:50000);

L1_1=L1(1:100);
L1_2=L1(101:200);
L1_3=L1(201:300);
L1_4=L1(301:400);
L1_5=L1(401:500);
L1_6=L1(501:600);
L1_7=L1(601:700);
L1_8=L1(701:800);
L1_9=L1(801:900);
L1_10=L1(901:1000);
L1_11=L1(1001:1100);
L1_12=L1(1101:1200);
L1_13=L1(1201:1300);
L1_14=L1(1301:1400);
L1_15=L1(1401:1500);
L1_16=L1(1501:1600);
L1_17=L1(1601:1700);
L1_18=L1(1701:1800);
L1_19=L1(1801:1900);
L1_20=L1(1901:2000);
L1_21=L1(2001:2100);
L1_22=L1(2101:2200);
L1_23=L1(2201:2300);
L1_24=L1(2301:2400);
L1_25=L1(2401:2500);
L1_26=L1(2501:2600);
L1_27=L1(2601:2700);
L1_28=L1(2701:2800);
L1_29=L1(2801:2900);
L1_30=L1(2901:3000);
L1_31=L1(3001:3100);
L1_32=L1(3101:3200);
L1_33=L1(3201:3300);
L1_34=L1(3301:3400);
L1_35=L1(3401:3500);
L1_36=L1(3501:3600);
L1_37=L1(3601:3700);
L1_38=L1(3701:3800);
L1_39=L1(3801:3900);
L1_40=L1(3901:4000);
L1_41=L1(4001:4100);
L1_42=L1(4101:4200);
L1_43=L1(4201:4300);
L1_44=L1(4301:4400);
L1_45=L1(4401:4500);
L1_46=L1(4501:4600);
L1_47=L1(4601:4700);
L1_48=L1(4701:4800);
L1_49=L1(4801:4900);
L1_50=L1(4901:5000);
L1_51=L1(5001:5100);
L1_52=L1(5101:5200);
L1_53=L1(5201:5300);
L1_54=L1(5301:5400);
L1_55=L1(5401:5500);
L1_56=L1(5501:5600);
L1_57=L1(5601:5700);
L1_58=L1(5701:5800);
L1_59=L1(5801:5900);
L1_60=L1(5901:6000);
L1_61=L1(6001:6100);
L1_62=L1(6101:6200);
L1_63=L1(6201:6300);
L1_64=L1(6301:6400);
L1_65=L1(6401:6500);
L1_66=L1(6501:6600);
L1_67=L1(6601:6700);
L1_68=L1(6701:6800);
L1_69=L1(6801:6900);
L1_70=L1(6901:7000);
L1_71=L1(7001:7100);
L1_72=L1(7101:7200);
L1_73=L1(7201:7300);
L1_74=L1(7301:7400);
L1_75=L1(7401:7500);
L1_76=L1(7501:7600);
L1_77=L1(7601:7700);
L1_78=L1(7701:7800);
L1_79=L1(7801:7900);
L1_80=L1(7901:8000);
L1_81=L1(8001:8100);
L1_82=L1(8101:8200);
L1_83=L1(8201:8300);
L1_84=L1(8301:8400);
L1_85=L1(8401:8500);
L1_86=L1(8501:8600);
L1_87=L1(8601:8700);
L1_88=L1(8701:8800);
L1_89=L1(8801:8900);
L1_90=L1(8901:9000);
L1_91=L1(9001:9100);
L1_92=L1(9101:9200);
L1_93=L1(9201:9300);
L1_94=L1(9301:9400);
L1_95=L1(9401:9500);
L1_96=L1(9501:9600);
L1_97=L1(9601:9700);
L1_98=L1(9701:9800);
L1_99=L1(9801:9900);
L1_100=L1(9901:10000);
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
L2_1=L2(1:100);
L2_2=L2(101:200);
L2_3=L2(201:300);
L2_4=L2(301:400);
L2_5=L2(401:500);
L2_6=L2(501:600);
L2_7=L2(601:700);
L2_8=L2(701:800);
L2_9=L2(801:900);
L2_10=L2(901:1000);
L2_11=L2(1001:1100);
L2_12=L2(1101:1200);
L2_13=L2(1201:1300);
L2_14=L2(1301:1400);
L2_15=L2(1401:1500);
L2_16=L2(1501:1600);
L2_17=L2(1601:1700);
L2_18=L2(1701:1800);
L2_19=L2(1801:1900);
L2_20=L2(1901:2000);
L2_21=L2(2001:2100);
L2_22=L2(2101:2200);
L2_23=L2(2201:2300);
L2_24=L2(2301:2400);
L2_25=L2(2401:2500);
L2_26=L2(2501:2600);
L2_27=L2(2601:2700);
L2_28=L2(2701:2800);
L2_29=L2(2801:2900);
L2_30=L2(2901:3000);
L2_31=L2(3001:3100);
L2_32=L2(3101:3200);
L2_33=L2(3201:3300);
L2_34=L2(3301:3400);
L2_35=L2(3401:3500);
L2_36=L2(3501:3600);
L2_37=L2(3601:3700);
L2_38=L2(3701:3800);
L2_39=L2(3801:3900);
L2_40=L2(3901:4000);
L2_41=L2(4001:4100);
L2_42=L2(4101:4200);
L2_43=L2(4201:4300);
L2_44=L2(4301:4400);
L2_45=L2(4401:4500);
L2_46=L2(4501:4600);
L2_47=L2(4601:4700);
L2_48=L2(4701:4800);
L2_49=L2(4801:4900);
L2_50=L2(4901:5000);
L2_51=L2(5001:5100);
L2_52=L2(5101:5200);
L2_53=L2(5201:5300);
L2_54=L2(5301:5400);
L2_55=L2(5401:5500);
L2_56=L2(5501:5600);
L2_57=L2(5601:5700);
L2_58=L2(5701:5800);
L2_59=L2(5801:5900);
L2_60=L2(5901:6000);
L2_61=L2(6001:6100);
L2_62=L2(6101:6200);
L2_63=L2(6201:6300);
L2_64=L2(6301:6400);
L2_65=L2(6401:6500);
L2_66=L2(6501:6600);
L2_67=L2(6601:6700);
L2_68=L2(6701:6800);
L2_69=L2(6801:6900);
L2_70=L2(6901:7000);
L2_71=L2(7001:7100);
L2_72=L2(7101:7200);
L2_73=L2(7201:7300);
L2_74=L2(7301:7400);
L2_75=L2(7401:7500);
L2_76=L2(7501:7600);
L2_77=L2(7601:7700);
L2_78=L2(7701:7800);
L2_79=L2(7801:7900);
L2_80=L2(7901:8000);
L2_81=L2(8001:8100);
L2_82=L2(8101:8200);
L2_83=L2(8201:8300);
L2_84=L2(8301:8400);
L2_85=L2(8401:8500);
L2_86=L2(8501:8600);
L2_87=L2(8601:8700);
L2_88=L2(8701:8800);
L2_89=L2(8801:8900);
L2_90=L2(8901:9000);
L2_91=L2(9001:9100);
L2_92=L2(9101:9200);
L2_93=L2(9201:9300);
L2_94=L2(9301:9400);
L2_95=L2(9401:9500);
L2_96=L2(9501:9600);
L2_97=L2(9601:9700);
L2_98=L2(9701:9800);
L2_99=L2(9801:9900);
L2_100=L2(9901:10000);
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
L3_1=L3(1:100);
L3_2=L3(101:200);
L3_3=L3(201:300);
L3_4=L3(301:400);
L3_5=L3(401:500);
L3_6=L3(501:600);
L3_7=L3(601:700);
L3_8=L3(701:800);
L3_9=L3(801:900);
L3_10=L3(901:1000);
L3_11=L3(1001:1100);
L3_12=L3(1101:1200);
L3_13=L3(1201:1300);
L3_14=L3(1301:1400);
L3_15=L3(1401:1500);
L3_16=L3(1501:1600);
L3_17=L3(1601:1700);
L3_18=L3(1701:1800);
L3_19=L3(1801:1900);
L3_20=L3(1901:2000);
L3_21=L3(2001:2100);
L3_22=L3(2101:2200);
L3_23=L3(2201:2300);
L3_24=L3(2301:2400);
L3_25=L3(2401:2500);
L3_26=L3(2501:2600);
L3_27=L3(2601:2700);
L3_28=L3(2701:2800);
L3_29=L3(2801:2900);
L3_30=L3(2901:3000);
L3_31=L3(3001:3100);
L3_32=L3(3101:3200);
L3_33=L3(3201:3300);
L3_34=L3(3301:3400);
L3_35=L3(3401:3500);
L3_36=L3(3501:3600);
L3_37=L3(3601:3700);
L3_38=L3(3701:3800);
L3_39=L3(3801:3900);
L3_40=L3(3901:4000);
L3_41=L3(4001:4100);
L3_42=L3(4101:4200);
L3_43=L3(4201:4300);
L3_44=L3(4301:4400);
L3_45=L3(4401:4500);
L3_46=L3(4501:4600);
L3_47=L3(4601:4700);
L3_48=L3(4701:4800);
L3_49=L3(4801:4900);
L3_50=L3(4901:5000);
L3_51=L3(5001:5100);
L3_52=L3(5101:5200);
L3_53=L3(5201:5300);
L3_54=L3(5301:5400);
L3_55=L3(5401:5500);
L3_56=L3(5501:5600);
L3_57=L3(5601:5700);
L3_58=L3(5701:5800);
L3_59=L3(5801:5900);
L3_60=L3(5901:6000);
L3_61=L3(6001:6100);
L3_62=L3(6101:6200);
L3_63=L3(6201:6300);
L3_64=L3(6301:6400);
L3_65=L3(6401:6500);
L3_66=L3(6501:6600);
L3_67=L3(6601:6700);
L3_68=L3(6701:6800);
L3_69=L3(6801:6900);
L3_70=L3(6901:7000);
L3_71=L3(7001:7100);
L3_72=L3(7101:7200);
L3_73=L3(7201:7300);
L3_74=L3(7301:7400);
L3_75=L3(7401:7500);
L3_76=L3(7501:7600);
L3_77=L3(7601:7700);
L3_78=L3(7701:7800);
L3_79=L3(7801:7900);
L3_80=L3(7901:8000);
L3_81=L3(8001:8100);
L3_82=L3(8101:8200);
L3_83=L3(8201:8300);
L3_84=L3(8301:8400);
L3_85=L3(8401:8500);
L3_86=L3(8501:8600);
L3_87=L3(8601:8700);
L3_88=L3(8701:8800);
L3_89=L3(8801:8900);
L3_90=L3(8901:9000);
L3_91=L3(9001:9100);
L3_92=L3(9101:9200);
L3_93=L3(9201:9300);
L3_94=L3(9301:9400);
L3_95=L3(9401:9500);
L3_96=L3(9501:9600);
L3_97=L3(9601:9700);
L3_98=L3(9701:9800);
L3_99=L3(9801:9900);
L3_100=L3(9901:10000);
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
L4_1=L4(1:100);
L4_2=L4(101:200);
L4_3=L4(201:300);
L4_4=L4(301:400);
L4_5=L4(401:500);
L4_6=L4(501:600);
L4_7=L4(601:700);
L4_8=L4(701:800);
L4_9=L4(801:900);
L4_10=L4(901:1000);
L4_11=L4(1001:1100);
L4_12=L4(1101:1200);
L4_13=L4(1201:1300);
L4_14=L4(1301:1400);
L4_15=L4(1401:1500);
L4_16=L4(1501:1600);
L4_17=L4(1601:1700);
L4_18=L4(1701:1800);
L4_19=L4(1801:1900);
L4_20=L4(1901:2000);
L4_21=L4(2001:2100);
L4_22=L4(2101:2200);
L4_23=L4(2201:2300);
L4_24=L4(2301:2400);
L4_25=L4(2401:2500);
L4_26=L4(2501:2600);
L4_27=L4(2601:2700);
L4_28=L4(2701:2800);
L4_29=L4(2801:2900);
L4_30=L4(2901:3000);
L4_31=L4(3001:3100);
L4_32=L4(3101:3200);
L4_33=L4(3201:3300);
L4_34=L4(3301:3400);
L4_35=L4(3401:3500);
L4_36=L4(3501:3600);
L4_37=L4(3601:3700);
L4_38=L4(3701:3800);
L4_39=L4(3801:3900);
L4_40=L4(3901:4000);
L4_41=L4(4001:4100);
L4_42=L4(4101:4200);
L4_43=L4(4201:4300);
L4_44=L4(4301:4400);
L4_45=L4(4401:4500);
L4_46=L4(4501:4600);
L4_47=L4(4601:4700);
L4_48=L4(4701:4800);
L4_49=L4(4801:4900);
L4_50=L4(4901:5000);
L4_51=L4(5001:5100);
L4_52=L4(5101:5200);
L4_53=L4(5201:5300);
L4_54=L4(5301:5400);
L4_55=L4(5401:5500);
L4_56=L4(5501:5600);
L4_57=L4(5601:5700);
L4_58=L4(5701:5800);
L4_59=L4(5801:5900);
L4_60=L4(5901:6000);
L4_61=L4(6001:6100);
L4_62=L4(6101:6200);
L4_63=L4(6201:6300);
L4_64=L4(6301:6400);
L4_65=L4(6401:6500);
L4_66=L4(6501:6600);
L4_67=L4(6601:6700);
L4_68=L4(6701:6800);
L4_69=L4(6801:6900);
L4_70=L4(6901:7000);
L4_71=L4(7001:7100);
L4_72=L4(7101:7200);
L4_73=L4(7201:7300);
L4_74=L4(7301:7400);
L4_75=L4(7401:7500);
L4_76=L4(7501:7600);
L4_77=L4(7601:7700);
L4_78=L4(7701:7800);
L4_79=L4(7801:7900);
L4_80=L4(7901:8000);
L4_81=L4(8001:8100);
L4_82=L4(8101:8200);
L4_83=L4(8201:8300);
L4_84=L4(8301:8400);
L4_85=L4(8401:8500);
L4_86=L4(8501:8600);
L4_87=L4(8601:8700);
L4_88=L4(8701:8800);
L4_89=L4(8801:8900);
L4_90=L4(8901:9000);
L4_91=L4(9001:9100);
L4_92=L4(9101:9200);
L4_93=L4(9201:9300);
L4_94=L4(9301:9400);
L4_95=L4(9401:9500);
L4_96=L4(9501:9600);
L4_97=L4(9601:9700);
L4_98=L4(9701:9800);
L4_99=L4(9801:9900);
L4_100=L4(9901:10000);
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
L5_1=L5(1:100);
L5_2=L5(101:200);
L5_3=L5(201:300);
L5_4=L5(301:400);
L5_5=L5(401:500);
L5_6=L5(501:600);
L5_7=L5(601:700);
L5_8=L5(701:800);
L5_9=L5(801:900);
L5_10=L5(901:1000);
L5_11=L5(1001:1100);
L5_12=L5(1101:1200);
L5_13=L5(1201:1300);
L5_14=L5(1301:1400);
L5_15=L5(1401:1500);
L5_16=L5(1501:1600);
L5_17=L5(1601:1700);
L5_18=L5(1701:1800);
L5_19=L5(1801:1900);
L5_20=L5(1901:2000);
L5_21=L5(2001:2100);
L5_22=L5(2101:2200);
L5_23=L5(2201:2300);
L5_24=L5(2301:2400);
L5_25=L5(2401:2500);
L5_26=L5(2501:2600);
L5_27=L5(2601:2700);
L5_28=L5(2701:2800);
L5_29=L5(2801:2900);
L5_30=L5(2901:3000);
L5_31=L5(3001:3100);
L5_32=L5(3101:3200);
L5_33=L5(3201:3300);
L5_34=L5(3301:3400);
L5_35=L5(3401:3500);
L5_36=L5(3501:3600);
L5_37=L5(3601:3700);
L5_38=L5(3701:3800);
L5_39=L5(3801:3900);
L5_40=L5(3901:4000);
L5_41=L5(4001:4100);
L5_42=L5(4101:4200);
L5_43=L5(4201:4300);
L5_44=L5(4301:4400);
L5_45=L5(4401:4500);
L5_46=L5(4501:4600);
L5_47=L5(4601:4700);
L5_48=L5(4701:4800);
L5_49=L5(4801:4900);
L5_50=L5(4901:5000);
L5_51=L5(5001:5100);
L5_52=L5(5101:5200);
L5_53=L5(5201:5300);
L5_54=L5(5301:5400);
L5_55=L5(5401:5500);
L5_56=L5(5501:5600);
L5_57=L5(5601:5700);
L5_58=L5(5701:5800);
L5_59=L5(5801:5900);
L5_60=L5(5901:6000);
L5_61=L5(6001:6100);
L5_62=L5(6101:6200);
L5_63=L5(6201:6300);
L5_64=L5(6301:6400);
L5_65=L5(6401:6500);
L5_66=L5(6501:6600);
L5_67=L5(6601:6700);
L5_68=L5(6701:6800);
L5_69=L5(6801:6900);
L5_70=L5(6901:7000);
L5_71=L5(7001:7100);
L5_72=L5(7101:7200);
L5_73=L5(7201:7300);
L5_74=L5(7301:7400);
L5_75=L5(7401:7500);
L5_76=L5(7501:7600);
L5_77=L5(7601:7700);
L5_78=L5(7701:7800);
L5_79=L5(7801:7900);
L5_80=L5(7901:8000);
L5_81=L5(8001:8100);
L5_82=L5(8101:8200);
L5_83=L5(8201:8300);
L5_84=L5(8301:8400);
L5_85=L5(8401:8500);
L5_86=L5(8501:8600);
L5_87=L5(8601:8700);
L5_88=L5(8701:8800);
L5_89=L5(8801:8900);
L5_90=L5(8901:9000);
L5_91=L5(9001:9100);
L5_92=L5(9101:9200);
L5_93=L5(9201:9300);
L5_94=L5(9301:9400);
L5_95=L5(9401:9500);
L5_96=L5(9501:9600);
L5_97=L5(9601:9700);
L5_98=L5(9701:9800);
L5_99=L5(9801:9900);
L5_100=L5(9901:10000);
%=================================================
% matriz del consumo para la matriz M
C1_1=C1(1:100);
C1_2=C1(101:200);
C1_3=C1(201:300);
C1_4=C1(301:400);
C1_5=C1(401:500);
C1_6=C1(501:600);
C1_7=C1(601:700);
C1_8=C1(701:800);
C1_9=C1(801:900);
C1_10=C1(901:1000);
C1_11=C1(1001:1100);
C1_12=C1(1101:1200);
C1_13=C1(1201:1300);
C1_14=C1(1301:1400);
C1_15=C1(1401:1500);
C1_16=C1(1501:1600);
C1_17=C1(1601:1700);
C1_18=C1(1701:1800);
C1_19=C1(1801:1900);
C1_20=C1(1901:2000);
C1_21=C1(2001:2100);
C1_22=C1(2101:2200);
C1_23=C1(2201:2300);
C1_24=C1(2301:2400);
C1_25=C1(2401:2500);
C1_26=C1(2501:2600);
C1_27=C1(2601:2700);
C1_28=C1(2701:2800);
C1_29=C1(2801:2900);
C1_30=C1(2901:3000);
C1_31=C1(3001:3100);
C1_32=C1(3101:3200);
C1_33=C1(3201:3300);
C1_34=C1(3301:3400);
C1_35=C1(3401:3500);
C1_36=C1(3501:3600);
C1_37=C1(3601:3700);
C1_38=C1(3701:3800);
C1_39=C1(3801:3900);
C1_40=C1(3901:4000);
C1_41=C1(4001:4100);
C1_42=C1(4101:4200);
C1_43=C1(4201:4300);
C1_44=C1(4301:4400);
C1_45=C1(4401:4500);
C1_46=C1(4501:4600);
C1_47=C1(4601:4700);
C1_48=C1(4701:4800);
C1_49=C1(4801:4900);
C1_50=C1(4901:5000);
C1_51=C1(5001:5100);
C1_52=C1(5101:5200);
C1_53=C1(5201:5300);
C1_54=C1(5301:5400);
C1_55=C1(5401:5500);
C1_56=C1(5501:5600);
C1_57=C1(5601:5700);
C1_58=C1(5701:5800);
C1_59=C1(5801:5900);
C1_60=C1(5901:6000);
C1_61=C1(6001:6100);
C1_62=C1(6101:6200);
C1_63=C1(6201:6300);
C1_64=C1(6301:6400);
C1_65=C1(6401:6500);
C1_66=C1(6501:6600);
C1_67=C1(6601:6700);
C1_68=C1(6701:6800);
C1_69=C1(6801:6900);
C1_70=C1(6901:7000);
C1_71=C1(7001:7100);
C1_72=C1(7101:7200);
C1_73=C1(7201:7300);
C1_74=C1(7301:7400);
C1_75=C1(7401:7500);
C1_76=C1(7501:7600);
C1_77=C1(7601:7700);
C1_78=C1(7701:7800);
C1_79=C1(7801:7900);
C1_80=C1(7901:8000);
C1_81=C1(8001:8100);
C1_82=C1(8101:8200);
C1_83=C1(8201:8300);
C1_84=C1(8301:8400);
C1_85=C1(8401:8500);
C1_86=C1(8501:8600);
C1_87=C1(8601:8700);
C1_88=C1(8701:8800);
C1_89=C1(8801:8900);
C1_90=C1(8901:9000);
C1_91=C1(9001:9100);
C1_92=C1(9101:9200);
C1_93=C1(9201:9300);
C1_94=C1(9301:9400);
C1_95=C1(9401:9500);
C1_96=C1(9501:9600);
C1_97=C1(9601:9700);
C1_98=C1(9701:9800);
C1_99=C1(9801:9900);
C1_100=C1(9901:10000);
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
C2_1=C2(1:100);
C2_2=C2(101:200);
C2_3=C2(201:300);
C2_4=C2(301:400);
C2_5=C2(401:500);
C2_6=C2(501:600);
C2_7=C2(601:700);
C2_8=C2(701:800);
C2_9=C2(801:900);
C2_10=C2(901:1000);
C2_11=C2(1001:1100);
C2_12=C2(1101:1200);
C2_13=C2(1201:1300);
C2_14=C2(1301:1400);
C2_15=C2(1401:1500);
C2_16=C2(1501:1600);
C2_17=C2(1601:1700);
C2_18=C2(1701:1800);
C2_19=C2(1801:1900);
C2_20=C2(1901:2000);
C2_21=C2(2001:2100);
C2_22=C2(2101:2200);
C2_23=C2(2201:2300);
C2_24=C2(2301:2400);
C2_25=C2(2401:2500);
C2_26=C2(2501:2600);
C2_27=C2(2601:2700);
C2_28=C2(2701:2800);
C2_29=C2(2801:2900);
C2_30=C2(2901:3000);
C2_31=C2(3001:3100);
C2_32=C2(3101:3200);
C2_33=C2(3201:3300);
C2_34=C2(3301:3400);
C2_35=C2(3401:3500);
C2_36=C2(3501:3600);
C2_37=C2(3601:3700);
C2_38=C2(3701:3800);
C2_39=C2(3801:3900);
C2_40=C2(3901:4000);
C2_41=C2(4001:4100);
C2_42=C2(4101:4200);
C2_43=C2(4201:4300);
C2_44=C2(4301:4400);
C2_45=C2(4401:4500);
C2_46=C2(4501:4600);
C2_47=C2(4601:4700);
C2_48=C2(4701:4800);
C2_49=C2(4801:4900);
C2_50=C2(4901:5000);
C2_51=C2(5001:5100);
C2_52=C2(5101:5200);
C2_53=C2(5201:5300);
C2_54=C2(5301:5400);
C2_55=C2(5401:5500);
C2_56=C2(5501:5600);
C2_57=C2(5601:5700);
C2_58=C2(5701:5800);
C2_59=C2(5801:5900);
C2_60=C2(5901:6000);
C2_61=C2(6001:6100);
C2_62=C2(6101:6200);
C2_63=C2(6201:6300);
C2_64=C2(6301:6400);
C2_65=C2(6401:6500);
C2_66=C2(6501:6600);
C2_67=C2(6601:6700);
C2_68=C2(6701:6800);
C2_69=C2(6801:6900);
C2_70=C2(6901:7000);
C2_71=C2(7001:7100);
C2_72=C2(7101:7200);
C2_73=C2(7201:7300);
C2_74=C2(7301:7400);
C2_75=C2(7401:7500);
C2_76=C2(7501:7600);
C2_77=C2(7601:7700);
C2_78=C2(7701:7800);
C2_79=C2(7801:7900);
C2_80=C2(7901:8000);
C2_81=C2(8001:8100);
C2_82=C2(8101:8200);
C2_83=C2(8201:8300);
C2_84=C2(8301:8400);
C2_85=C2(8401:8500);
C2_86=C2(8501:8600);
C2_87=C2(8601:8700);
C2_88=C2(8701:8800);
C2_89=C2(8801:8900);
C2_90=C2(8901:9000);
C2_91=C2(9001:9100);
C2_92=C2(9101:9200);
C2_93=C2(9201:9300);
C2_94=C2(9301:9400);
C2_95=C2(9401:9500);
C2_96=C2(9501:9600);
C2_97=C2(9601:9700);
C2_98=C2(9701:9800);
C2_99=C2(9801:9900);
C2_100=C2(9901:10000);
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
C3_1=C3(1:100);
C3_2=C3(101:200);
C3_3=C3(201:300);
C3_4=C3(301:400);
C3_5=C3(401:500);
C3_6=C3(501:600);
C3_7=C3(601:700);
C3_8=C3(701:800);
C3_9=C3(801:900);
C3_10=C3(901:1000);
C3_11=C3(1001:1100);
C3_12=C3(1101:1200);
C3_13=C3(1201:1300);
C3_14=C3(1301:1400);
C3_15=C3(1401:1500);
C3_16=C3(1501:1600);
C3_17=C3(1601:1700);
C3_18=C3(1701:1800);
C3_19=C3(1801:1900);
C3_20=C3(1901:2000);
C3_21=C3(2001:2100);
C3_22=C3(2101:2200);
C3_23=C3(2201:2300);
C3_24=C3(2301:2400);
C3_25=C3(2401:2500);
C3_26=C3(2501:2600);
C3_27=C3(2601:2700);
C3_28=C3(2701:2800);
C3_29=C3(2801:2900);
C3_30=C3(2901:3000);
C3_31=C3(3001:3100);
C3_32=C3(3101:3200);
C3_33=C3(3201:3300);
C3_34=C3(3301:3400);
C3_35=C3(3401:3500);
C3_36=C3(3501:3600);
C3_37=C3(3601:3700);
C3_38=C3(3701:3800);
C3_39=C3(3801:3900);
C3_40=C3(3901:4000);
C3_41=C3(4001:4100);
C3_42=C3(4101:4200);
C3_43=C3(4201:4300);
C3_44=C3(4301:4400);
C3_45=C3(4401:4500);
C3_46=C3(4501:4600);
C3_47=C3(4601:4700);
C3_48=C3(4701:4800);
C3_49=C3(4801:4900);
C3_50=C3(4901:5000);
C3_51=C3(5001:5100);
C3_52=C3(5101:5200);
C3_53=C3(5201:5300);
C3_54=C3(5301:5400);
C3_55=C3(5401:5500);
C3_56=C3(5501:5600);
C3_57=C3(5601:5700);
C3_58=C3(5701:5800);
C3_59=C3(5801:5900);
C3_60=C3(5901:6000);
C3_61=C3(6001:6100);
C3_62=C3(6101:6200);
C3_63=C3(6201:6300);
C3_64=C3(6301:6400);
C3_65=C3(6401:6500);
C3_66=C3(6501:6600);
C3_67=C3(6601:6700);
C3_68=C3(6701:6800);
C3_69=C3(6801:6900);
C3_70=C3(6901:7000);
C3_71=C3(7001:7100);
C3_72=C3(7101:7200);
C3_73=C3(7201:7300);
C3_74=C3(7301:7400);
C3_75=C3(7401:7500);
C3_76=C3(7501:7600);
C3_77=C3(7601:7700);
C3_78=C3(7701:7800);
C3_79=C3(7801:7900);
C3_80=C3(7901:8000);
C3_81=C3(8001:8100);
C3_82=C3(8101:8200);
C3_83=C3(8201:8300);
C3_84=C3(8301:8400);
C3_85=C3(8401:8500);
C3_86=C3(8501:8600);
C3_87=C3(8601:8700);
C3_88=C3(8701:8800);
C3_89=C3(8801:8900);
C3_90=C3(8901:9000);
C3_91=C3(9001:9100);
C3_92=C3(9101:9200);
C3_93=C3(9201:9300);
C3_94=C3(9301:9400);
C3_95=C3(9401:9500);
C3_96=C3(9501:9600);
C3_97=C3(9601:9700);
C3_98=C3(9701:9800);
C3_99=C3(9801:9900);
C3_100=C3(9901:10000);
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
C4_1=C4(1:100);
C4_2=C4(101:200);
C4_3=C4(201:300);
C4_4=C4(301:400);
C4_5=C4(401:500);
C4_6=C4(501:600);
C4_7=C4(601:700);
C4_8=C4(701:800);
C4_9=C4(801:900);
C4_10=C4(901:1000);
C4_11=C4(1001:1100);
C4_12=C4(1101:1200);
C4_13=C4(1201:1300);
C4_14=C4(1301:1400);
C4_15=C4(1401:1500);
C4_16=C4(1501:1600);
C4_17=C4(1601:1700);
C4_18=C4(1701:1800);
C4_19=C4(1801:1900);
C4_20=C4(1901:2000);
C4_21=C4(2001:2100);
C4_22=C4(2101:2200);
C4_23=C4(2201:2300);
C4_24=C4(2301:2400);
C4_25=C4(2401:2500);
C4_26=C4(2501:2600);
C4_27=C4(2601:2700);
C4_28=C4(2701:2800);
C4_29=C4(2801:2900);
C4_30=C4(2901:3000);
C4_31=C4(3001:3100);
C4_32=C4(3101:3200);
C4_33=C4(3201:3300);
C4_34=C4(3301:3400);
C4_35=C4(3401:3500);
C4_36=C4(3501:3600);
C4_37=C4(3601:3700);
C4_38=C4(3701:3800);
C4_39=C4(3801:3900);
C4_40=C4(3901:4000);
C4_41=C4(4001:4100);
C4_42=C4(4101:4200);
C4_43=C4(4201:4300);
C4_44=C4(4301:4400);
C4_45=C4(4401:4500);
C4_46=C4(4501:4600);
C4_47=C4(4601:4700);
C4_48=C4(4701:4800);
C4_49=C4(4801:4900);
C4_50=C4(4901:5000);
C4_51=C4(5001:5100);
C4_52=C4(5101:5200);
C4_53=C4(5201:5300);
C4_54=C4(5301:5400);
C4_55=C4(5401:5500);
C4_56=C4(5501:5600);
C4_57=C4(5601:5700);
C4_58=C4(5701:5800);
C4_59=C4(5801:5900);
C4_60=C4(5901:6000);
C4_61=C4(6001:6100);
C4_62=C4(6101:6200);
C4_63=C4(6201:6300);
C4_64=C4(6301:6400);
C4_65=C4(6401:6500);
C4_66=C4(6501:6600);
C4_67=C4(6601:6700);
C4_68=C4(6701:6800);
C4_69=C4(6801:6900);
C4_70=C4(6901:7000);
C4_71=C4(7001:7100);
C4_72=C4(7101:7200);
C4_73=C4(7201:7300);
C4_74=C4(7301:7400);
C4_75=C4(7401:7500);
C4_76=C4(7501:7600);
C4_77=C4(7601:7700);
C4_78=C4(7701:7800);
C4_79=C4(7801:7900);
C4_80=C4(7901:8000);
C4_81=C4(8001:8100);
C4_82=C4(8101:8200);
C4_83=C4(8201:8300);
C4_84=C4(8301:8400);
C4_85=C4(8401:8500);
C4_86=C4(8501:8600);
C4_87=C4(8601:8700);
C4_88=C4(8701:8800);
C4_89=C4(8801:8900);
C4_90=C4(8901:9000);
C4_91=C4(9001:9100);
C4_92=C4(9101:9200);
C4_93=C4(9201:9300);
C4_94=C4(9301:9400);
C4_95=C4(9401:9500);
C4_96=C4(9501:9600);
C4_97=C4(9601:9700);
C4_98=C4(9701:9800);
C4_99=C4(9801:9900);
C4_100=C4(9901:10000);
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
C5_1=C5(1:100);
C5_2=C5(101:200);
C5_3=C5(201:300);
C5_4=C5(301:400);
C5_5=C5(401:500);
C5_6=C5(501:600);
C5_7=C5(601:700);
C5_8=C5(701:800);
C5_9=C5(801:900);
C5_10=C5(901:1000);
C5_11=C5(1001:1100);
C5_12=C5(1101:1200);
C5_13=C5(1201:1300);
C5_14=C5(1301:1400);
C5_15=C5(1401:1500);
C5_16=C5(1501:1600);
C5_17=C5(1601:1700);
C5_18=C5(1701:1800);
C5_19=C5(1801:1900);
C5_20=C5(1901:2000);
C5_21=C5(2001:2100);
C5_22=C5(2101:2200);
C5_23=C5(2201:2300);
C5_24=C5(2301:2400);
C5_25=C5(2401:2500);
C5_26=C5(2501:2600);
C5_27=C5(2601:2700);
C5_28=C5(2701:2800);
C5_29=C5(2801:2900);
C5_30=C5(2901:3000);
C5_31=C5(3001:3100);
C5_32=C5(3101:3200);
C5_33=C5(3201:3300);
C5_34=C5(3301:3400);
C5_35=C5(3401:3500);
C5_36=C5(3501:3600);
C5_37=C5(3601:3700);
C5_38=C5(3701:3800);
C5_39=C5(3801:3900);
C5_40=C5(3901:4000);
C5_41=C5(4001:4100);
C5_42=C5(4101:4200);
C5_43=C5(4201:4300);
C5_44=C5(4301:4400);
C5_45=C5(4401:4500);
C5_46=C5(4501:4600);
C5_47=C5(4601:4700);
C5_48=C5(4701:4800);
C5_49=C5(4801:4900);
C5_50=C5(4901:5000);
C5_51=C5(5001:5100);
C5_52=C5(5101:5200);
C5_53=C5(5201:5300);
C5_54=C5(5301:5400);
C5_55=C5(5401:5500);
C5_56=C5(5501:5600);
C5_57=C5(5601:5700);
C5_58=C5(5701:5800);
C5_59=C5(5801:5900);
C5_60=C5(5901:6000);
C5_61=C5(6001:6100);
C5_62=C5(6101:6200);
C5_63=C5(6201:6300);
C5_64=C5(6301:6400);
C5_65=C5(6401:6500);
C5_66=C5(6501:6600);
C5_67=C5(6601:6700);
C5_68=C5(6701:6800);
C5_69=C5(6801:6900);
C5_70=C5(6901:7000);
C5_71=C5(7001:7100);
C5_72=C5(7101:7200);
C5_73=C5(7201:7300);
C5_74=C5(7301:7400);
C5_75=C5(7401:7500);
C5_76=C5(7501:7600);
C5_77=C5(7601:7700);
C5_78=C5(7701:7800);
C5_79=C5(7801:7900);
C5_80=C5(7901:8000);
C5_81=C5(8001:8100);
C5_82=C5(8101:8200);
C5_83=C5(8201:8300);
C5_84=C5(8301:8400);
C5_85=C5(8401:8500);
C5_86=C5(8501:8600);
C5_87=C5(8601:8700);
C5_88=C5(8701:8800);
C5_89=C5(8801:8900);
C5_90=C5(8901:9000);
C5_91=C5(9001:9100);
C5_92=C5(9101:9200);
C5_93=C5(9201:9300);
C5_94=C5(9301:9400);
C5_95=C5(9401:9500);
C5_96=C5(9501:9600);
C5_97=C5(9601:9700);
C5_98=C5(9701:9800);
C5_99=C5(9801:9900);
C5_100=C5(9901:10000);
%=====================================================
%Matriz del trabajo del tamaño de la matriz M
HH=[L1_1;L2_1;L3_1;L4_1;L5_1;
    L1_2;L2_2;L3_2;L4_2;L5_2;
    L1_3;L2_3;L3_3;L4_3;L5_3;
    L1_4;L2_4;L3_4;L4_4;L5_4;
    L1_5;L2_5;L3_5;L4_5;L5_5;
    L1_6;L2_6;L3_6;L4_6;L5_6;
    L1_7;L2_7;L3_7;L4_7;L5_7;
    L1_8;L2_8;L3_8;L4_8;L5_8;
    L1_9;L2_9;L3_9;L4_9;L5_9;
    L1_10;L2_10;L3_10;L4_10;L5_10;
    L1_11;L2_11;L3_11;L4_11;L5_11;
    L1_12;L2_12;L3_12;L4_12;L5_12;
    L1_13;L2_13;L3_13;L4_13;L5_13;
    L1_14;L2_14;L3_14;L4_14;L5_14;
    L1_15;L2_15;L3_15;L4_15;L5_15;
    L1_16;L2_16;L3_16;L4_16;L5_16;
    L1_17;L2_17;L3_17;L4_17;L5_17;
    L1_18;L2_18;L3_18;L4_18;L5_18;
    L1_19;L2_19;L3_19;L4_19;L5_19;
    L1_20;L2_20;L3_20;L4_20;L5_20;
    L1_21;L2_21;L3_21;L4_21;L5_21;
    L1_22;L2_22;L3_22;L4_22;L5_22;
    L1_23;L2_23;L3_23;L4_23;L5_23;
    L1_24;L2_24;L3_24;L4_24;L5_24;
    L1_25;L2_25;L3_25;L4_25;L5_25;
    L1_26;L2_26;L3_26;L4_26;L5_26;
    L1_27;L2_27;L3_27;L4_27;L5_27;
    L1_28;L2_28;L3_28;L4_28;L5_28;
    L1_29;L2_29;L3_29;L4_29;L5_29;
    L1_30;L2_30;L3_30;L4_30;L5_30;
    L1_31;L2_31;L3_31;L4_31;L5_31;
    L1_32;L2_32;L3_32;L4_32;L5_32;
    L1_33;L2_33;L3_33;L4_33;L5_33;
    L1_34;L2_34;L3_34;L4_34;L5_34;
    L1_35;L2_35;L3_35;L4_35;L5_35;
    L1_36;L2_36;L3_36;L4_36;L5_36;
    L1_37;L2_37;L3_37;L4_37;L5_37;
    L1_38;L2_38;L3_38;L4_38;L5_38;
    L1_39;L2_39;L3_39;L4_39;L5_39;
    L1_40;L2_40;L3_40;L4_40;L5_40;
    L1_41;L2_41;L3_41;L4_41;L5_41;
    L1_42;L2_42;L3_42;L4_42;L5_42;
    L1_43;L2_43;L3_43;L4_43;L5_43;
    L1_44;L2_44;L3_44;L4_44;L5_44;
    L1_45;L2_45;L3_45;L4_45;L5_45;
    L1_46;L2_46;L3_46;L4_46;L5_46;
    L1_47;L2_47;L3_47;L4_47;L5_47;
    L1_48;L2_48;L3_48;L4_48;L5_48;
    L1_49;L2_49;L3_49;L4_49;L5_49;
    L1_50;L2_50;L3_50;L4_50;L5_50;
    L1_51;L2_51;L3_51;L4_51;L5_51;
    L1_52;L2_52;L3_52;L4_52;L5_52;
    L1_53;L2_53;L3_53;L4_53;L5_53;
    L1_54;L2_54;L3_54;L4_54;L5_54;
    L1_55;L2_55;L3_55;L4_55;L5_55;
    L1_56;L2_56;L3_56;L4_56;L5_56;
    L1_57;L2_57;L3_57;L4_57;L5_57;
    L1_58;L2_58;L3_58;L4_58;L5_58;
    L1_59;L2_59;L3_59;L4_59;L5_59;
    L1_60;L2_60;L3_60;L4_60;L5_60;
    L1_61;L2_61;L3_61;L4_61;L5_61;
    L1_62;L2_62;L3_62;L4_62;L5_62;
    L1_63;L2_63;L3_63;L4_63;L5_63;
    L1_64;L2_64;L3_64;L4_64;L5_64;
    L1_65;L2_65;L3_65;L4_65;L5_65;
    L1_66;L2_66;L3_66;L4_66;L5_66;
    L1_67;L2_67;L3_67;L4_67;L5_67;
    L1_68;L2_68;L3_68;L4_68;L5_68;
    L1_69;L2_69;L3_69;L4_69;L5_69;
    L1_70;L2_70;L3_70;L4_70;L5_70;
    L1_71;L2_71;L3_71;L4_71;L5_71;
    L1_72;L2_72;L3_72;L4_72;L5_72;
    L1_73;L2_73;L3_73;L4_73;L5_73;
    L1_74;L2_74;L3_74;L4_74;L5_74;
    L1_75;L2_75;L3_75;L4_75;L5_75;
    L1_76;L2_76;L3_76;L4_76;L5_76;
    L1_77;L2_77;L3_77;L4_77;L5_77;
    L1_78;L2_78;L3_78;L4_78;L5_78;
    L1_79;L2_79;L3_79;L4_79;L5_79;
    L1_80;L2_80;L3_80;L4_80;L5_80;
    L1_81;L2_81;L3_81;L4_81;L5_81;
    L1_82;L2_82;L3_82;L4_82;L5_82;
    L1_83;L2_83;L3_83;L4_83;L5_83;
    L1_84;L2_84;L3_84;L4_84;L5_84;
    L1_85;L2_85;L3_85;L4_85;L5_85;
    L1_86;L2_86;L3_86;L4_86;L5_86;
    L1_87;L2_87;L3_87;L4_87;L5_87;
    L1_88;L2_88;L3_88;L4_88;L5_88;
    L1_89;L2_89;L3_89;L4_89;L5_89;
    L1_90;L2_90;L3_90;L4_90;L5_90;
    L1_91;L2_91;L3_91;L4_91;L5_91;
    L1_92;L2_92;L3_92;L4_92;L5_92;
    L1_93;L2_93;L3_93;L4_93;L5_93;
    L1_94;L2_94;L3_94;L4_94;L5_94;
    L1_95;L2_95;L3_95;L4_95;L5_95;
    L1_96;L2_96;L3_96;L4_96;L5_96;
    L1_97;L2_97;L3_97;L4_97;L5_97;
    L1_98;L2_98;L3_98;L4_98;L5_98;
    L1_99;L2_99;L3_99;L4_99;L5_99;
    L1_100;L2_100;L3_100;L4_100;L5_100];

 value(:,:,3)=HH;
%======================================
%CALCULO MATRIZ CONSUMO para la M
%
CCC=[C1_1;C2_1;C3_1;C4_1;C5_1;
    C1_2;C2_2;C3_2;C4_2;C5_2;
    C1_3;C2_3;C3_3;C4_3;C5_3;
    C1_4;C2_4;C3_4;C4_4;C5_4;
    C1_5;C2_5;C3_5;C4_5;C5_5;
    C1_6;C2_6;C3_6;C4_6;C5_6;
    C1_7;C2_7;C3_7;C4_7;C5_7;
    C1_8;C2_8;C3_8;C4_8;C5_8;
    C1_9;C2_9;C3_9;C4_9;C5_9;
    C1_10;C2_10;C3_10;C4_10;C5_10;
    C1_11;C2_11;C3_11;C4_11;C5_11;
    C1_12;C2_12;C3_12;C4_12;C5_12;
    C1_13;C2_13;C3_13;C4_13;C5_13;
    C1_14;C2_14;C3_14;C4_14;C5_14;
    C1_15;C2_15;C3_15;C4_15;C5_15;
    C1_16;C2_16;C3_16;C4_16;C5_16;
    C1_17;C2_17;C3_17;C4_17;C5_17;
    C1_18;C2_18;C3_18;C4_18;C5_18;
    C1_19;C2_19;C3_19;C4_19;C5_19;
    C1_20;C2_20;C3_20;C4_20;C5_20;
    C1_21;C2_21;C3_21;C4_21;C5_21;
    C1_22;C2_22;C3_22;C4_22;C5_22;
    C1_23;C2_23;C3_23;C4_23;C5_23;
    C1_24;C2_24;C3_24;C4_24;C5_24;
    C1_25;C2_25;C3_25;C4_25;C5_25;
    C1_26;C2_26;C3_26;C4_26;C5_26;
    C1_27;C2_27;C3_27;C4_27;C5_27;
    C1_28;C2_28;C3_28;C4_28;C5_28;
    C1_29;C2_29;C3_29;C4_29;C5_29;
    C1_30;C2_30;C3_30;C4_30;C5_30;
    C1_31;C2_31;C3_31;C4_31;C5_31;
    C1_32;C2_32;C3_32;C4_32;C5_32;
    C1_33;C2_33;C3_33;C4_33;C5_33;
    C1_34;C2_34;C3_34;C4_34;C5_34;
    C1_35;C2_35;C3_35;C4_35;C5_35;
    C1_36;C2_36;C3_36;C4_36;C5_36;
    C1_37;C2_37;C3_37;C4_37;C5_37;
    C1_38;C2_38;C3_38;C4_38;C5_38;
    C1_39;C2_39;C3_39;C4_39;C5_39;
    C1_40;C2_40;C3_40;C4_40;C5_40;
    C1_41;C2_41;C3_41;C4_41;C5_41;
    C1_42;C2_42;C3_42;C4_42;C5_42;
    C1_43;C2_43;C3_43;C4_43;C5_43;
    C1_44;C2_44;C3_44;C4_44;C5_44;
    C1_45;C2_45;C3_45;C4_45;C5_45;
    C1_46;C2_46;C3_46;C4_46;C5_46;
    C1_47;C2_47;C3_47;C4_47;C5_47;
    C1_48;C2_48;C3_48;C4_48;C5_48;
    C1_49;C2_49;C3_49;C4_49;C5_49;
    C1_50;C2_50;C3_50;C4_50;C5_50;
    C1_51;C2_51;C3_51;C4_51;C5_51;
    C1_52;C2_52;C3_52;C4_52;C5_52;
    C1_53;C2_53;C3_53;C4_53;C5_53;
    C1_54;C2_54;C3_54;C4_54;C5_54;
    C1_55;C2_55;C3_55;C4_55;C5_55;
    C1_56;C2_56;C3_56;C4_56;C5_56;
    C1_57;C2_57;C3_57;C4_57;C5_57;
    C1_58;C2_58;C3_58;C4_58;C5_58;
    C1_59;C2_59;C3_59;C4_59;C5_59;
    C1_60;C2_60;C3_60;C4_60;C5_60;
    C1_61;C2_61;C3_61;C4_61;C5_61;
    C1_62;C2_62;C3_62;C4_62;C5_62;
    C1_63;C2_63;C3_63;C4_63;C5_63;
    C1_64;C2_64;C3_64;C4_64;C5_64;
    C1_65;C2_65;C3_65;C4_65;C5_65;
    C1_66;C2_66;C3_66;C4_66;C5_66;
    C1_67;C2_67;C3_67;C4_67;C5_67;
    C1_68;C2_68;C3_68;C4_68;C5_68;
    C1_69;C2_69;C3_69;C4_69;C5_69;
    C1_70;C2_70;C3_70;C4_70;C5_70;
    C1_71;C2_71;C3_71;C4_71;C5_71;
    C1_72;C2_72;C3_72;C4_72;C5_72;
    C1_73;C2_73;C3_73;C4_73;C5_73;
    C1_74;C2_74;C3_74;C4_74;C5_74;
    C1_75;C2_75;C3_75;C4_75;C5_75;
    C1_76;C2_76;C3_76;C4_76;C5_76;
    C1_77;C2_77;C3_77;C4_77;C5_77;
    C1_78;C2_78;C3_78;C4_78;C5_78;
    C1_79;C2_79;C3_79;C4_79;C5_79;
    C1_80;C2_80;C3_80;C4_80;C5_80;
    C1_81;C2_81;C3_81;C4_81;C5_81;
    C1_82;C2_82;C3_82;C4_82;C5_82;
    C1_83;C2_83;C3_83;C4_83;C5_83;
    C1_84;C2_84;C3_84;C4_84;C5_84;
    C1_85;C2_85;C3_85;C4_85;C5_85;
    C1_86;C2_86;C3_86;C4_86;C5_86;
    C1_87;C2_87;C3_87;C4_87;C5_87;
    C1_88;C2_88;C3_88;C4_88;C5_88;
    C1_89;C2_89;C3_89;C4_89;C5_89;
    C1_90;C2_90;C3_90;C4_90;C5_90;
    C1_91;C2_91;C3_91;C4_91;C5_91;
    C1_92;C2_92;C3_92;C4_92;C5_92;
    C1_93;C2_93;C3_93;C4_93;C5_93;
    C1_94;C2_94;C3_94;C4_94;C5_94;
    C1_95;C2_95;C3_95;C4_95;C5_95;
    C1_96;C2_96;C3_96;C4_96;C5_96;
    C1_97;C2_97;C3_97;C4_97;C5_97;
    C1_98;C2_98;C3_98;C4_98;C5_98;
    C1_99;C2_99;C3_99;C4_99;C5_99;
    C1_100;C2_100;C3_100;C4_100;C5_100];

value(:,:,5)=CCC;

%=========================================================================
% coloca la matriz de trabajo como columnas.
%matriz M

M      = zeros(p*q,p);

M = (1-gamma).* log(value(:,:,5))+ gamma.*log((1-value(:,:,3)));

% Construction of auxiliary matrix  
    
I   = eye(q);
E   = I;

for i=1:p-1
    E=[E;I];
end

% Sets initial guess for value function (V0=0)

V0 = zeros(p*q,1);

% Value function iteration

terminate = 0;
it = 1;
while (terminate==0 & it<maxit)
	[V1,G] = max((M+beta*(E*(pi*reshape(V0,q,p))))'); % la ultima trasnpuestas es por la funcion que quiero filas y no columnas
	V1     = V1';
	G      = G';
	if norm(V0-V1)<crit
		terminate=1;
	end
	disp(['Iteration= ',num2str(it),'  Error= ',num2str(norm(V0-V1))])
	V0     = V1;
	it     = it+1;
end

G1=G;
G = zeros(p,q);
V = zeros(p,q);

for i=1:p
    G(i,1) = G1((i-1)*q+1);
    G(i,2) = G1((i-1)*q+2);
    G(i,3) = G1((i-1)*q+3);
    G(i,4) = G1((i-1)*q+4);
    G(i,5) = G1((i-1)*q+5);
    V(i,1) = V1((i-1)*q+1);
    V(i,2) = V1((i-1)*q+2);
    V(i,3) = V1((i-1)*q+3);
    V(i,4) = V1((i-1)*q+4);
    V(i,5) = V1((i-1)*q+5);
        
end

G(1,1)=1;
G(1,2)=1;
G(1,3)=1;
G(1,4)=1;
G(1,5)=1;

V(1,1)=V(2,1);
V(1,2)=V(2,2);
V(1,3)=V(2,3);
V(1,4)=V(2,4);
V(1,5)=V(2,5);

%=========================================================================
%Calculo del trabajo para el shock, capital t, capital t+1 optimo.  
%
for m=1:q %bloques
    for j= 1:length(k) %columnas
%       for l= 1:length(k) %filas
  % nn(l): labor no puede ser mayor que uno
        l0   = 0.25;
        kkk = k(j);
        kprima = k(G1((1-q)+q*j,1));
        zzz = theta(m);
        %[nn(l,m), fval ] = fsolve( @(l) hfun(l), l0 );
        [nnop(j,m), fval, flag] = fsolve(@(j) hfunj(j,kkk,kprima,zzz),l0);
       if nnop(j,m)>=1 | flag~=1;
          nnop(j,m) = 1-eps;
       end
       cccc(j,m)= max((exp(zzz) * kkk^alpha * nnop(j,m)^(1-alpha)-(kprima - (1 - delta) * kkk)),eps);
       
%       end
    end
 end

figure(1)
subplot(4,1,2)
plot(k,k(G(:,1)),'oy',k,k(G(:,2)),'-.r',k,k(G(:,3)),'*g',k,k(G(:,4)),'--black',k,k(G(:,5)),'b'),xlabel('')
ylabel('k(t+1)'), legend('z1=-0.02','z2=-0.01','z3=0','z4=0.01','z5=0.02'), title('Optimal Capital'),axis([45 95 20 100])

subplot(4,1,1)
plot(k,V(:,1),'oy',k,V(:,2),'-.r',k,V(:,3),'*g',k,V(:,4),'--black',k,V(:,5),'b'),xlabel('')
ylabel('') ,legend('z1=-0.02','z2=-0.01','z3=0','z4=0.01','z5=0.02'), title('Value Function')

subplot(4,1,3)
plot(k,cccc(:,1),'oy',k,cccc(:,2),'-.r',k,cccc(:,3),'*g',k,cccc(:,4),'--black',k,cccc(:,5),'b'),xlabel('')
ylabel('c'), legend('z1=-0.02','z2=-0.01','z3=0','z4=0.01','z5=0.02'), title('Optimal Consumption')

subplot(4,1,4)
plot(k,nnop(:,1),'oy',k,nnop(:,2),'-.r',k,nnop(:,3),'*g',k,nnop(:,4),'--black',k,nnop(:,5),'b'),xlabel('capital')
ylabel('l') ,legend('z1=-0.02','z2=-0.01','z3=0','z4=0.01','z5=0.02'), title('Optimal Labor')

toc

%% ==========================================================
%  Parte II: SIMULACON DE HISTORIA CHOQUES
%  ==========================================================

tic
T = 100;
pi_acum = cumsum(pi',1)';

shocks = ones(T,1)*3;
shocks(1)=4;
theta(shocks)

for i=1:T-1
    va = random('unif',0,1);
    for j=1:q
        for l=1:q
            if shocks(i)==j
                if l==1
                    if va<=pi_acum(j,l)
                        shocks(i+1)=l;
                    end
                end
                if l>1
                    if va<=pi_acum(j,l) & va>pi_acum(j,l-1)
                        shocks(i+1)=l;
                    end
                end
            end
        end
    end
end

theta(shocks)         
% Simulates optimal paths for capital (kt), consumption (ct),
% investment (it) and output (yt)
%
kt    = zeros(T+1,1);
ind   = zeros(T,1);
[aux,ind(1)] = min(k<k0);
kt(1) = k(ind(1)-20);

%
for t = 1:T
   ind(t+1) = G(ind(t),shocks(t));  
   kt(t+1)  = k(ind(t+1)); 
end

ht = zeros(T,1);
it = zeros(T,1);
ct = zeros(T,1);
yt = zeros(T,1);

for t=1:T
    %%
        l0   = 0.25;
        kkk = kt(t);
        kprima = kt(t+1);
        zzz = theta(shocks(t));
        %[nn(l,m), fval ] = fsolve( @(l) hfun(l), l0 );
        [ht(t), fval, flag] = fsolve(@(t) hfunj(t,kkk,kprima,zzz),l0);
        if ht(t)>=1 | flag~=1;
          ht(t) = (1 - eps);
        end
    
    it(t) = kt(t+1)-(1-delta)*kt(t);
    yt(t) = exp(theta(shocks(t)))*A*kt(t)^alpha*ht(t)^(1-alpha);
    ct(t) = yt(t)-it(t);
end

figure(2)
subplot(3,2,1), plot(1:T,theta(shocks)), title('Technology Shock')%, axis([0 100 -.5 .5])
subplot(3,2,2), plot(1:T+1,kt), title('Capital')%,axis([0 100 0 3])
subplot(3,2,3), plot(1:T,yt), title('Output')
subplot(3,2,4), plot(1:T,ct), title('Consumption')
subplot(3,2,5), plot(1:T,it), title('Investment')
subplot(3,2,6), plot(1:T,ht), title('Labor') %,axis([0 100 0 1])

toc

%% ==========================================================
%  Parte III: SIMULACION PARA SACAR CORRELACIONES
%  ==========================================================

%demora 1583,108 segundos
tic
% We calculate statistics
T_stat = 10000;

for m=1:100

shocks_stat = zeros(T_stat,1);
shocks_stat(1)=3;


for i=1:T_stat-1
    va = random('unif',0,1);
    for j=1:q
        for l=1:q
            if shocks_stat(i)==j
                if l==1
                    if va<=pi_acum(j,l)
                        shocks_stat(i+1)=l;
                    end
                end
                if l>1
                    if va<=pi_acum(j,l) & va>pi_acum(j,l-1)
                        shocks_stat(i+1)=l;
                    end
                end
            end
        end
    end
end

kt_stat    = zeros(T_stat+1,1);
ind_stat   = zeros(T_stat,1);
[aux,ind_stat(1)] = min(k<k0);
kt_stat(1) = k(ind_stat(1)-20);

for t = 1:T_stat
   ind_stat(t+1) = G(ind_stat(t),shocks_stat(t));  
   kt_stat(t+1)  = k(ind_stat(t+1)); 
end
%
ht_stat = zeros(T_stat,1);
it_stat = zeros(T_stat,1);
ct_stat = zeros(T_stat,1);
yt_stat = zeros(T_stat,1);

for t=1:T_stat
    
        l0   = 0.25;
        kkk = kt_stat(t);
        kprima = kt_stat(t+1);
        zzz = theta(shocks_stat(t));
        %[nn(l,m), fval ] = fsolve( @(l) hfun(l), l0 );
        [ht_stat(t), fval, flag] = fsolve(@(t) hfunj(t,kkk,kprima,zzz),l0);
        if ht_stat(t)>=1 | flag~=1;
          ht_stat(t) = (1 - eps);
        end
    it_stat(t) = kt_stat(t+1)-(1-delta)*kt_stat(t);
    yt_stat(t) = exp(theta(shocks_stat(t)))*A*(kt_stat(t)^alpha)*(ht_stat(t)^(1-alpha));
    ct_stat(t) = yt_stat(t)-it_stat(t);
end

kt_std(m) = std(log(kt_stat(1000:T_stat)));
yt_std(m) = std(log(yt_stat(1000:T_stat)));
ct_std(m) = std(log(ct_stat(1000:T_stat)));
it_std(m) = std(log(it_stat(1000:T_stat)));
ht_std(m) = std(log(ht_stat(1000:T_stat)));

kt_yt_correl(m) = corr(kt_stat(1:T_stat),yt_stat);
ct_yt_correl(m)= corr(ct_stat,yt_stat);
it_yt_correl(m) = corr(it_stat,yt_stat);
ht_yt_correl(m) = corr(ht_stat(1:T_stat),yt_stat);

m
end

disp(' ')
disp('Standard Deviation of the log: ')
disp(' ')

disp(['- Output        = ',num2str(mean(yt_std))])
disp(['- Consumption   = ',num2str(mean(ct_std))])
disp(['- Investment    = ',num2str(mean(it_std))])
disp(['- Capital       = ',num2str(mean(kt_std))])
disp(['- Labor         = ',num2str(mean(ht_std))])

disp(' ')
disp('Correlation with Output of: ')
disp(' ')
disp(['- Consumption   = ',num2str(mean(ct_yt_correl))])
disp(['- Investment    = ',num2str(mean(it_yt_correl))])
disp(['- Capital       = ',num2str(mean(kt_yt_correl))])
disp(['- Labor         = ',num2str(mean(ht_yt_correl))])
disp(' ')
toc

%% ==========================================================
%  Parte IV:  FUNCION IMPULSO RESPUESTA
%  ==========================================================

T = 100;
pi_acum = cumsum(pi',1)';
theta = [-0.0231 -0.0115 0 0.0115 0.0231];
shocks = ones(T,1)*3;
shocks(1)=4;
theta(shocks);

kt    = zeros(T+1,1)
ind   = zeros(T,1);
 [aux,ind(1)] = min(k<k0);
 kt(1) = k(ind(1)-10);
%

for t = 1:T
   ind(t+1) = G(ind(t),shocks(t));  
   kt(t+1)  = k(ind(t+1)); 
end

ht = zeros(T,1);
it = zeros(T,1);
ct = zeros(T,1);
yt = zeros(T,1);

for t=1:T
    %%
        l0   = 0.25;
        kkk = kt(t);
        kprima = kt(t+1);
        zzz = theta(shocks(t));
        [ht(t), fval, flag] = fsolve(@(t) hfunj(t,kkk,kprima,zzz),l0);
       if ht(t)>=1 | flag~=1;
          ht(t) = (1 - eps);
       end
    
    it(t) = kt(t+1)-(1-delta)*kt(t);
    yt(t) = exp(theta(shocks(t)))*A*kt(t)^alpha*ht(t)^(1-alpha);
    ct(t) = yt(t)-it(t);
end

figure(2)
subplot(3,2,1), plot(1:T,theta(shocks),'--b','LineWidth',2.5), title('Choque Tecnológico')
subplot(3,2,2), plot(1:T+1,kt,'--b','LineWidth',2.5), title('Capital'),axis([0 100 0 80])
subplot(3,2,3), plot(1:T,yt,'--b','LineWidth',2.5), title('Producto')
subplot(3,2,4), plot(1:T,ct,'--b','LineWidth',2.5), title('Consumo')
subplot(3,2,5), plot(1:T,it,'--b','LineWidth',2.5), title('Inversión')
subplot(3,2,6), plot(1:T,ht,'--b','LineWidth',2.5), title('Trabajo') %axis([0 100 0 1])

%==========================================================================
%==========================FIN DE PROGRAMA=================================
%==========================================================================
